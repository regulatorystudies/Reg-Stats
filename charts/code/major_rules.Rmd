---
title: "Number of Final Major Rules Published by Pres Year"
author: "Yaxin Zhuang"
date: "`r Sys.Date()`"
output: html_document
---

## Initialize

We begin by initializing the Rmarkdown file. This is where we set relevant parameters and establish where this markdown file is located within the project directory, using the `[here](https://here.r-lib.org/reference/i_am.html)` package.

The `i_am` function indicates that `workflow_demo.Rmd` is located within the `code` folder inside the main project directory. In other words, the project root is located immediately above the `code` folder. All future calls to files are based on their relative location to the project root.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# set location of this file in project directory
library(here)
i_am("charts/code/Number of Final Major Rules Published by Pres year.Rmd")

# import local functions
source(here("charts", "code", "local_utils.R"))
source(here("charts", "code", "style.R"))

# point to dataset
data_file = "major_rules_by_presidential_year.csv"

# refresh dataset
copy_dataset(data_file, here("data"), here("charts", "data"))

```

Import the packages required for the remainder of the rmarkdown file. It's easier to keep track of the necessary packages when all imports occur at the top of the file.

## Load Packages

```{r imports, results='hide', warning=FALSE}

# load packages
library(ggplot2)
library(showtext)
library(png)
library(ggpattern)
library(tidyr)
library(ggrepel)
library(dplyr)
library(scales)
library(gcookbook)

```

## Load Style

```{r load style}
# load style
source(here("code", "style.R"))
```

## Load data


```{r load_data}

# load csv using here
num_fr <- read.csv(here("data", data_file))

# eventually separate this into another file for reuse, then import/call the function
get_png <- function(filename) {
  grid::rasterGrob(png::readPNG(filename),interpolate = TRUE) # adjust logo size dimensions here
}

l <- get_png(here("code", "RSC_logo.png"))

#load custom font
font_add("avenir_lt_pro","a-avenir-next-lt-pro.otf")
showtext_auto()

```

## Process data


```{r clean_data}

num_fr <- num_fr[c(2:28),c(0:5)]
# issue: there are always some rows do not have data, have description/annotation

colnames(num_fr) <- c("year", "totalmr", "tmrexcludnonsig","party","fay")

num_fr$totalmr<- as.numeric(num_fr$totalmr)
num_fr$tmrexcludnonsig <- as.numeric(num_fr$tmrexcludnonsig)

# make party factor variable
num_fr$party <- as.factor(num_fr$party)
```


## Plot data


```{r plot_data, results='markup'}
current_date <- format(Sys.Date(), "%B %d, %Y")
caption_text <- paste("Sources: Government Accountability Office \n\nUpdated:", current_date)
wrapped_caption <- paste(strwrap(caption_text, width = 95), collapse = "\n")

bar1 <-
  ggplot(num_fr, aes(x = year, y = totalmr, fill= party,pattern = party)) +
  geom_bar_pattern(stat = "identity", width = 0.5,
                   pattern_color = NA,
                    pattern_fill = "#B2DDF4",
                    pattern_angle = 45,
                    pattern_density = 0.1,
                    pattern_spacing = 0.03,
                   # pattern_key_scale_factor = 1
                   ) +
  scale_fill_manual(values = c("#C9102F","#033C5A")) +
  scale_pattern_manual(values = c("1"="stripe", "0"="none")) +
  theme_minimal() +
  ggtitle("Number of Final Major Rules Published by Presidential Year") +
  ylab("Number of Major Rules") +
  xlab("") +
  scale_y_continuous(breaks = seq(0, max(num_fr$totalmr) + 25, by = 25), expand = c(0, 0),
                     limits = c(-2, max(num_fr$totalmr) + 25)) +
  # scale_y_continuous()
  annotation_custom(l, xmin = -5, xmax = 10, ymin = -20, ymax = -50) + # for logo
  coord_cartesian(clip = "off") +
  theme_RSC +
  labs(caption = wrapped_caption)
bar1

#ggsave("Number of Final Major Rules Published by Presidential Year.pdf", plot = bar1, width = 12, height = 9, dpi = 300)

```

