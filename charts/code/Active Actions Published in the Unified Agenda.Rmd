---
title: "Active Actions Published in the Unified Agenda"
author: "Yaxin Zhuang"
date: "`r Sys.Date()`"
output: html_document
---
## Initialize

We begin by initializing the Rmarkdown file. This is where we set relevant parameters and establish where this markdown file is located within the project directory, using the `[here](https://here.r-lib.org/reference/i_am.html)` package.

The `i_am` function indicates that `workflow_demo.Rmd` is located within the `code` folder inside the main project directory. In other words, the project root is located immediately above the `code` folder. All future calls to files are based on their relative location to the project root.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# set location of this file in project directory
here::i_am("code/Number of Final Major Rules Published by Pres year.Rmd")
```

Import the packages required for the remainder of the rmarkdown file. It's easier to keep track of the necessary packages when all imports occur at the top of the file.

## Load Packages

```{r imports, results='hide', warning=FALSE}

# load packages
library(ggplot2)
library(showtext)
library(png)
library(ggpattern)
library(tidyr)
library(ggrepel)
library(dplyr)
library(scales)
```

## Load Style

```{r load style}
# load style
source(here("code", "style.R"))
```

## Load data


```{r load_data}

# load csv using here
df1 <- read.csv("/content/Active%20Actions%20Listed%20in%20the%20Unified%20Agenda_071023.csv")

# eventually separate this into another file for reuse, then import/call the function
get_png <- function(filename) {
  grid::rasterGrob(png::readPNG(filename),interpolate = TRUE) # adjust logo size dimensions here
}

l <- get_png(here("code", "RSC_logo.png"))

#load custom font
font_add("avenir_lt_pro","a-avenir-next-lt-pro.otf")
showtext_auto()

```

## Process data


```{r clean_data}

df1_1 <- df1[c(3:48),c(0:5)]

colnames(df1_1) <- c("yearseason", "FinalRules", "ProposedRules","Prerules","Total")

df1_1$Total <- as.numeric(df1_1$Total)

df1_1$sort <- seq.int(nrow(df1_1))

#df1_1
data_new1 <- df1_1 %>% arrange(desc(sort))

data_new1$yearseason <-factor(data_new1$yearseason,levels=unique(data_new1$yearseason))

#split year and season
# data_new1[c('year', 'season')] <- str_split_fixed(data_new1$yearseason, ' ', 2) 

```


## Plot data


```{r plot_data, results='markup'}
#annotation
current_date <- format(Sys.Date(), "%B %d, %Y")
caption_text <- paste("Sources: Office of Information and RedulatoryAffairs \n\nUpdated:", current_date)
wrapped_caption <- paste(strwrap(caption_text, width = 95), collapse = "\n")

#font
font_add("avenir_lt_pro","a-avenir-next-lt-pro.otf")
showtext_auto()

#plot
bar2 <-
  ggplot(data=data_new1, aes(x=yearseason, y=Total)) +
  geom_bar(stat="identity", fill="#033C5A")+

  ggtitle("Active Actions Published in the Unified Agenda \n(1950-2021)") +
  ylab("Number of Active Actions") +
  xlab("") +
  mytheme+
  scale_y_continuous(breaks = seq(0, max(data_new1$Total), by = 500), expand = c(0, 0),
                     limits = c(-2, max(data_new1$Total)),) +
                     #labels = label_number(suffix = "K", scale = 1e-3)) +
  # scale_y_continuous()
  annotation_custom(l, xmin = -2, xmax = 10, ymin = -800, ymax = -1200) + # for logo
  # logo_y_dim = 0.3logo_y_max, logo_x_dim = 0.12logo_x_max ?
  coord_cartesian(clip = "off") +
  labs(caption = wrapped_caption)


bar2
#ggsave("Active Actions Published in the Unified Agenda(1950-2021).pdf", plot = bar2, width = 12, height = 9, dpi = 300)



```